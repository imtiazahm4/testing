!function(t){"use strict";var e,n,i=function(){return i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},i.apply(this,arguments)};function r(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))}function s(t,e){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function a(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}!function(t){t.NotInitialized="not_initialized",t.UserNotFound="user_not_found",t.UserMismatch="user_mismatch",t.UsernameInputNotFound="username_input_not_found",t.MissingPrepareStep="missing_prepare_step",t.RegistrationFailed="registration_failed",t.AuthenticationFailed="authentication_failed",t.InvalidAuthSession="invalid_auth_session",t.InvalidApprovalData="invalid_approval_data",t.Unknown="unknown",t.InvalidPasskeysMediationType="invalid_passkeys_mediation_type"}(e||(e={})),function(t){t.InputAutofill="input-autofill",t.Modal="modal"}(n||(n={}));var u,c=function(){function t(t,e){this.handler=t,this.timeout=e,this.resume()}return t.prototype.resume=function(){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(e){switch(e.label){case 0:return[4,this.handler()];case 1:return e.sent(),this.timeoutId=globalThis.setTimeout((function(){return t.resume()}),this.timeout),[2]}}))}))},t.prototype.pause=function(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=void 0},t}(),h={log:console.log,error:console.error};function d(t,e,n){return void 0===e&&(e=""),{errorCode:t,description:e,data:n}}!function(t){t[t.persistent=0]="persistent",t[t.session=1]="session"}(u||(u={}));var l=function(){function t(){}return t.get=function(e){return t.getStorageMedium(t.allowedKeys[e]).getItem(t.getStorageKey(e))||void 0},t.set=function(e,n){return t.getStorageMedium(t.allowedKeys[e]).setItem(t.getStorageKey(e),n)},t.remove=function(e){t.getStorageMedium(t.allowedKeys[e]).removeItem(t.getStorageKey(e))},t.clear=function(e){var n,i;try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.entries(t.allowedKeys)),s=r.next();!s.done;s=r.next()){var a=o(s.value,2),c=a[0],h=a[1],d=c;e&&this.configurationKeys.includes(d)||h===u.persistent||t.getStorageMedium(h).removeItem(t.getStorageKey(d))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}},t.getStorageKey=function(t){return"WebAuthnSdk:".concat(t)},t.getStorageMedium=function(t){return t===u.session?sessionStorage:localStorage},t.allowedKeys={authSessionId:u.session,clientId:u.session,deviceBindingToken:u.session,deviceUsers:u.persistent},t.configurationKeys=["clientId"],t}(),f=function(){function t(){}return t.init=function(t){try{this._serverPath=new URL(t)}catch(t){throw d(e.NotInitialized,"Invalid options.serverPath",{error:t})}},t.sendRequest=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o,a;return s(this,(function(s){switch(s.label){case 0:return h.log("[WebAuthn SDK] Calling ".concat(e.method," ").concat(t,"...")),r=l.get("deviceBindingToken"),(o=new URL(this._serverPath)).pathname+=t,[4,fetch(o.toString(),i(i({},e),{headers:i(i(i({},e.headers),n.authSessionId&&{"x-ts-flow-id":n.authSessionId}),r&&{"x-ts-device-binding-token":r})}))];case 1:return(a=s.sent()).headers.has("set-device-binding-token")&&l.set("deviceBindingToken",a.headers.get("set-device-binding-token")),[2,a]}}))}))},t.startRestrictedSession=function(t,e,n){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.sendRequest("v1/auth-session/start-restricted",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i(i({client_id:t},e&&{cross_device:{binding_message:e}}),n&&{approval_data:n}))},{})];case 1:return[4,r.sent().json()];case 2:return[2,r.sent()]}}))}))},t.startWebauthnRegistration=function(t,e,n){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.sendRequest("v1/webauthn/register/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t,user:{username:e,display_name:n}})},{authSessionId:t})];case 1:return[4,i.sent().json()];case 2:return[2,i.sent()]}}))}))},t.completeWebauthnRegistration=function(t,e,n){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.sendRequest("v1/webauthn/register/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t,webauthn_session_id:e,public_key_credential:n})},{authSessionId:t})];case 1:return[4,i.sent().json()];case 2:return[2,i.sent()]}}))}))},t.startWebauthnAuthentication=function(t,e){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.sendRequest("v1/webauthn/authenticate/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t,username:e})},{authSessionId:t})];case 1:return[4,n.sent().json()];case 2:return[2,n.sent()]}}))}))},t.completeWebauthnAuthentication=function(t,e,n){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.sendRequest("v1/webauthn/authenticate/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t,webauthn_session_id:e,public_key_credential:n})},{authSessionId:t})];case 1:return[4,i.sent().json()];case 2:return[2,i.sent()]}}))}))},t.getSessionStatus=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.sendRequest("v1/auth-session/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t})},{authSessionId:t})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},t.attachDeviceToSession=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.sendRequest("v1/auth-session/attach-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t})},{authSessionId:t})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},t.detachDeviceFromSession=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.sendRequest("v1/auth-session/detach-device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t})},{authSessionId:t})];case 1:return[2,e.sent().json()]}}))}))},t.startPasskeyAuthentication=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.sendRequest("v1/webauthn/authenticate/passkey/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t})},{authSessionId:t})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},t.completePasskeyAuthentication=function(t,e,n){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.sendRequest("v1/webauthn/authenticate/passkey/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_session_id:t,webauthn_session_id:e,public_key_credential:n})},{authSessionId:t})];case 1:return[4,i.sent().json()];case 2:return[2,i.sent()]}}))}))},t}(),p=function(){function t(t,n){var i=this;this.authSessionId=t,this.handlers=n,this._interval=new c((function(){return r(i,void 0,void 0,(function(){var t,n,i,r,o,a,u,c,d,l,p,v,y,g,b;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,12,,13]),[4,f.getSessionStatus(this.authSessionId)];case 1:return t=s.sent(),this._lastSessionStatus?this._lastSessionStatus.cross_device_status===t.cross_device_status?[3,11]:(n=void 0,"pending-attachment"!==t.cross_device_status?[3,2]:(h.log("cross_device_status was updated to pending-attachment. this should never happen."),[3,10])):[3,11];case 2:return"attached"!==t.cross_device_status?[3,4]:[4,null===(o=(r=this.handlers).onDeviceAttach)||void 0===o?void 0:o.call(r)];case 3:return n=s.sent(),[3,10];case 4:return"registered"!==t.cross_device_status?[3,6]:[4,null===(u=(a=this.handlers).onCredentialRegister)||void 0===u?void 0:u.call(a,null===(c=t.cross_device_result)||void 0===c?void 0:c.auth_code)];case 5:return n=s.sent(),[3,10];case 6:return"authenticated"!==t.cross_device_status?[3,8]:[4,null===(l=(d=this.handlers).onCredentialAuthenticate)||void 0===l?void 0:l.call(d,null===(p=t.cross_device_result)||void 0===p?void 0:p.auth_code)];case 7:return n=s.sent(),[3,10];case 8:return"completed"!==t.cross_device_status?[3,10]:[4,null===(y=(v=this.handlers).onDeviceDetach)||void 0===y?void 0:y.call(v)];case 9:n=s.sent(),s.label=10;case 10:!1===n&&this.destroy(),s.label=11;case 11:return this._lastSessionStatus=t,[3,13];case 12:return i=s.sent(),h.error("error in WebAuthn cross device session polling: ",i),this.destroy(),null===(b=(g=this.handlers).onFailure)||void 0===b||b.call(g,e.Unknown),[3,13];case 13:return[2]}}))}))}),3e3)}return t.prototype.destroy=function(){this._interval.pause()},t.prototype.getController=function(){var t=this;return{stop:function(){return r(t,void 0,void 0,(function(){return s(this,(function(t){return this.destroy(),[2]}))}))},authSessionId:this.authSessionId}},t}(),v=function(){function t(){}return t.get=function(){var t;return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2,JSON.parse(null!==(t=l.get("deviceUsers"))&&void 0!==t?t:"[]")]}))}))},t.persist=function(e){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,t.get()];case 1:return n=(n=i.sent()).map((function(t){return{username:t.username,isCurrent:!1}})),n=a([{username:e,isCurrent:!0}],o(n.filter((function(t){return t.username!==e}))),!1),l.set("deviceUsers",JSON.stringify(n)),[2]}}))}))},t.remove=function(e){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,t.get()];case 1:return n=(n=i.sent()).filter((function(t){return t.username!==e})),l.set("deviceUsers",JSON.stringify(n)),[2]}}))}))},t.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){return l.set("deviceUsers","[]"),[2]}))}))},t}(),y=function(){function t(){}return t.arrayBufferToBase64=function(t){return btoa(String.fromCharCode.apply(String,a([],o(new Uint8Array(t)),!1)))},t.base64ToArrayBuffer=function(t){return Uint8Array.from(atob(t),(function(t){return t.charCodeAt(0)}))},t}(),g=function(){function t(t){this._getter=t,this._resolved=!1}return t.prototype.get=function(){var t=this;return this._valuePromise||(this._valuePromise=this._getter().then((function(e){return t._resolved=!0,e}))),this._valuePromise},Object.defineProperty(t.prototype,"resolved",{get:function(){return this._resolved},enumerable:!1,configurable:!0}),t}(),b=function(){function t(t,e){var n=this;this.authSessionId=t,this.username=e,this.startAuthenticationResponse=new g((function(){return r(n,void 0,void 0,(function(){return s(this,(function(t){return[2,f.startWebauthnAuthentication(this.authSessionId,e)]}))}))}))}return Object.defineProperty(t.prototype,"isReady",{get:function(){return this.startAuthenticationResponse.resolved},enumerable:!1,configurable:!0}),t.prototype.prepare=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.startAuthenticationResponse.get()];case 1:return t.sent(),[2]}}))}))},t.prototype.execute=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a;return s(this,(function(s){switch(s.label){case 0:return[4,this.startAuthenticationResponse.get()];case 1:return t=s.sent(),(e=t.credential_request_options).challenge=y.base64ToArrayBuffer(e.challenge),e.allowCredentials=e.allowCredentials.map((function(t){return i(i({},t),{id:y.base64ToArrayBuffer(t.id)})})),[4,navigator.credentials.get({publicKey:e})];case 2:return n=s.sent(),r=n.response,o={id:n.id,rawId:y.arrayBufferToBase64(n.rawId),response:{authenticatorData:y.arrayBufferToBase64(r.authenticatorData),clientDataJSON:y.arrayBufferToBase64(r.clientDataJSON),signature:y.arrayBufferToBase64(r.signature),userHandle:y.arrayBufferToBase64(r.userHandle)},type:n.type},[4,f.completeWebauthnAuthentication(this.authSessionId,t.webauthn_session_id,o)];case 3:return a=s.sent(),this.result=a.auth_code,v.persist(this.username),[2]}}))}))},t}(),_=function(){function t(t){var e=this;this.authSessionId=t,this.startPasskeyAuthenticationResponse=new g((function(){return r(e,void 0,void 0,(function(){return s(this,(function(t){return[2,f.startPasskeyAuthentication(this.authSessionId)]}))}))}))}return Object.defineProperty(t.prototype,"isReady",{get:function(){return this.startPasskeyAuthenticationResponse.resolved},enumerable:!1,configurable:!0}),t.prototype.prepare=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.startPasskeyAuthenticationResponse.get()];case 1:return t.sent(),[2]}}))}))},t.prototype.execute=function(t){return void 0===t&&(t=n.InputAutofill),r(this,void 0,void 0,(function(){var e,n,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:return[4,this.startPasskeyAuthenticationResponse.get()];case 1:return e=s.sent(),(n=e.credential_request_options).challenge=y.base64ToArrayBuffer(n.challenge),n.allowCredentials=[],[4,navigator.credentials.get(this.getMediatedCredentialRequest(n,t))];case 2:return i=s.sent(),r=i.response,o={id:i.id,rawId:y.arrayBufferToBase64(i.rawId),response:{authenticatorData:y.arrayBufferToBase64(r.authenticatorData),clientDataJSON:y.arrayBufferToBase64(r.clientDataJSON),signature:y.arrayBufferToBase64(r.signature),userHandle:y.arrayBufferToBase64(r.userHandle)},type:i.type},[4,f.completePasskeyAuthentication(this.authSessionId,e.webauthn_session_id,o)];case 3:return a=s.sent(),this.result=a.auth_code,[2]}}))}))},t.prototype.getMediatedCredentialRequest=function(t,e){var i={publicKey:t};return e===n.InputAutofill&&(i.mediation="conditional"),i},t}(),S=function(){function t(t,e,n){var i=this;this.authSessionId=t,this.username=e,this.startRegistrationResponse=new g((function(){return r(i,void 0,void 0,(function(){return s(this,(function(t){return[2,f.startWebauthnRegistration(this.authSessionId,e,n)]}))}))}))}return Object.defineProperty(t.prototype,"isReady",{get:function(){return this.startRegistrationResponse.resolved},enumerable:!1,configurable:!0}),t.prototype.prepare=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.startRegistrationResponse.get()];case 1:return t.sent(),[2]}}))}))},t.prototype.execute=function(t,e){return r(this,void 0,void 0,(function(){var n,i,r,o,a,u;return s(this,(function(s){switch(s.label){case 0:return[4,this.startRegistrationResponse.get()];case 1:return n=s.sent(),(i=n.credential_creation_options).challenge=y.base64ToArrayBuffer(i.challenge),i.user.id=y.base64ToArrayBuffer(i.user.id),e&&(i.authenticatorSelection.residentKey="preferred",i.authenticatorSelection.requireResidentKey="true"),i.authenticatorSelection.authenticatorAttachment=t?void 0:"platform",[4,navigator.credentials.create({publicKey:i})];case 2:return r=s.sent(),o=r.response,a={id:r.id,rawId:y.arrayBufferToBase64(r.rawId),response:{attestationObject:y.arrayBufferToBase64(o.attestationObject),clientDataJSON:y.arrayBufferToBase64(o.clientDataJSON)},type:r.type},[4,f.completeWebauthnRegistration(this.authSessionId,n.webauthn_session_id,a)];case 3:return u=s.sent(),this.result=u.auth_code,v.persist(this.username),[2]}}))}))},t}(),w=/^[A-Za-z0-9\-_.]*$/;function m(t){if(t&&(!function(t){return Object.keys(t).length<=10}(t)||!function(t){var e=function(t){return"string"==typeof t},n=function(t){return w.test(t)};return Object.keys(t).every((function(i){return e(i)&&e(t[i])&&n(i)&&n(t[i])}))}(t)))throw h.error("Failed validating approval data"),d(e.InvalidApprovalData,"Provided approval data should have ".concat(10," properties max. Also, it should contain only alphanumeric characters, numbers, and the special characters: '-', '_', '.'"))}var I=function(){function t(){this._initialized=!1}return t.prototype.init=function(t,n){return r(this,void 0,void 0,(function(){return s(this,(function(i){try{if(this._clearSdkSessionState(),f.init(n.serverPath),!t)throw d(e.NotInitialized,"Invalid clientId",{clientId:t});l.set("clientId",t),this._initialized=!0}catch(t){throw"string"==typeof(r=t).errorCode&&"string"==typeof r.description?t:d(e.NotInitialized,"Something went wrong",{error:t})}var r;return[2]}))}))},t.prototype.reset=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){return this._clearSdkSessionState(!0),[2]}))}))},t.prototype._clearSdkSessionState=function(t){l.clear(t),this._initialized=!!t&&this._initialized,this._currentRegistrationSession=void 0,this._currentAuthenticationSession=void 0,this._currentCrossDeviceSessionHandler=void 0},t.prototype._optionallyStartRestrictedSession=function(t){return r(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=l.get("authSessionId"),!t&&e?[3,2]:[4,f.startRestrictedSession(l.get("clientId"),void 0,t)];case 1:e=n.sent().auth_session_id,l.set("authSessionId",e),n.label=2;case 2:return[2,e]}}))}))},t.prototype.isPlatformAuthenticatorSupported=function(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()];case 1:return[2,e.sent()];case 2:return t=e.sent(),h.error(t),[2,!1];case 3:return[2]}}))}))},t.prototype.isPasskeySupported=function(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return(t=PublicKeyCredential.isConditionalMediationAvailable)?[4,PublicKeyCredential.isConditionalMediationAvailable()]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return[2,!!t]}}))}))},t.prototype.prepareWebauthnRegistration=function(t,n,i){return r(this,void 0,void 0,(function(){var r;return s(this,(function(s){if(!this._initialized)throw d(e.NotInitialized);if(i)(r=l.get("authSessionId"))&&r!==i&&l.remove("deviceBindingToken"),l.set("authSessionId",i);else if(!(i=l.get("authSessionId")))throw d(e.InvalidAuthSession,"authSessionId was not provided");return this._currentRegistrationSession=new S(i,t,null!=n?n:t),[2,this._currentRegistrationSession.prepare()]}))}))},t.prototype._validateRegistrationPreparation=function(){return r(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(r){switch(r.label){case 0:if(!this._currentRegistrationSession)throw d(e.MissingPrepareStep,"executeWebauthnRegistration() cannot be called before prepareWebauthnRegistration()");t=5,n=500,i=0,r.label=1;case 1:return this._currentRegistrationSession.isReady?[2]:(i+=1,[4,(s=n,new Promise((function(t){return setTimeout(t,s)})))]);case 2:r.sent(),r.label=3;case 3:if(i<=t)return[3,1];r.label=4;case 4:throw d(e.MissingPrepareStep,"executeWebauthnRegistration() cannot be called before prepareWebauthnRegistration() has completed successfully")}var s}))}))},t.prototype.executeWebauthnRegistration=function(t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),r(this,void 0,void 0,(function(){var i;return s(this,(function(r){switch(r.label){case 0:if(!this._initialized)throw d(e.NotInitialized);return[4,this._validateRegistrationPreparation()];case 1:return r.sent(),[4,this._currentRegistrationSession.execute(t,n)];case 2:return r.sent(),i=this._currentRegistrationSession.result,this._currentRegistrationSession=void 0,[2,i]}}))}))},t.prototype.prepareWebauthnAuthentication=function(t,n){return r(this,void 0,void 0,(function(){var i;return s(this,(function(r){switch(r.label){case 0:if(!this._initialized)throw d(e.NotInitialized);return m(n),[4,this._optionallyStartRestrictedSession(n)];case 1:return i=r.sent(),this._currentAuthenticationSession=new b(i,t),[2,this._currentAuthenticationSession.prepare()]}}))}))},t.prototype.executeWebauthnAuthentication=function(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(!this._initialized)throw d(e.NotInitialized);if(!this._currentAuthenticationSession)throw d(e.MissingPrepareStep,"executeWebauthnAuthentication() cannot be called before prepareWebauthnAuthentication() has completed successfully");return[4,this._currentAuthenticationSession.execute()];case 1:return n.sent(),t=this._currentAuthenticationSession.result,this._currentAuthenticationSession=void 0,[2,t]}}))}))},t.prototype.startCrossDeviceFlow=function(t,n,i){return r(this,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:if(!this._initialized)throw d(e.NotInitialized);return m(i),this._currentRegistrationSession=void 0,this._currentAuthenticationSession=void 0,[4,f.startRestrictedSession(l.get("clientId"),n,i)];case 1:return r=s.sent().auth_session_id,l.set("authSessionId",r),this._currentCrossDeviceSessionHandler=new p(r,t),[2,this._currentCrossDeviceSessionHandler.getController()]}}))}))},t.prototype.attachDevice=function(t){return r(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return l.set("authSessionId",t),[4,f.attachDeviceToSession(t)];case 1:return e=n.sent(),[2,i({bindingMessage:e.binding_info.binding_message,originatingDevice:{osType:e.binding_info.originating_device.device_info.os_type,osVersion:e.binding_info.originating_device.device_info.os_version,browserType:e.binding_info.originating_device.device_info.browser_type,browserVersion:e.binding_info.originating_device.device_info.browser_version}},e.binding_info.approval_data&&{approvalData:e.binding_info.approval_data})]}}))}))},t.prototype.detachDevice=function(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(!(t=l.get("authSessionId")))throw d(e.InvalidAuthSession,"authSessionId was not provided");return[4,f.detachDeviceFromSession(t)];case 1:return n.sent(),[2]}}))}))},t.prototype.getDeviceUsers=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){return[2,v.get()]}))}))},t.prototype.preparePasskeyAuthentication=function(t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:if(!this._initialized)throw d(e.NotInitialized);return m(t),[4,this._optionallyStartRestrictedSession(t)];case 1:return n=i.sent(),this._currentPasskeyAuthenticationSession=new _(n),[2,this._currentPasskeyAuthenticationSession.prepare()]}}))}))},t.prototype.executePasskeyAuthentication=function(t){return void 0===t&&(t=n.InputAutofill),r(this,void 0,void 0,(function(){var i;return s(this,(function(r){switch(r.label){case 0:if(!Object.values(n).includes(t))throw d(e.InvalidPasskeysMediationType,"passkeysMediationType should be one of ".concat(Object.values(n)));if(!this._initialized)throw d(e.NotInitialized);if(!this._currentPasskeyAuthenticationSession)throw d(e.MissingPrepareStep,"executePasskeyAuthentication() cannot be called before preparePasskeyAuthentication() has completed successfully");return[4,this._currentPasskeyAuthenticationSession.execute(t)];case 1:return r.sent(),i=this._currentPasskeyAuthenticationSession.result,this._currentAuthenticationSession=void 0,[2,i]}}))}))},t}();globalThis.WebAuthnSdk=new I;var A=function(){function t(){this.webAuthn=new I}return t.prototype.init=function(t,e){var n=e.webAuthn.serverPath;this.webAuthn.init(t,{serverPath:n})},t}();globalThis.TsAuthSdk=new A,t.TsAuthSdk=A,t.default=A,Object.defineProperty(t,"__esModule",{value:!0})}({});
